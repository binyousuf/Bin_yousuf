---
// src/pages/projects/[id].astro
import type { GetStaticPaths } from "astro";
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import type { ProjectData } from '../../types/project';
import { projects } from '../../data/projects.js';

// Generate static paths for all projects
export const getStaticPaths: GetStaticPaths = async () => {
  const paths = projects.map((project) => {
    const projectId = project.name.toLowerCase().replace(/[\s&]/g, '-').replace(/--+/g, '-');
    
    return {
      params: { 
        id: projectId 
      },
      props: { 
        projectInfo: project,
        projectId: projectId
      }
    };
  });
  
  return paths;
};

const { projectInfo, projectId } = Astro.props;

// Import specific images based on project
let projectImages: any = {};
try {
  // Dynamically import only the images that exist for this specific project
  const imageModules = import.meta.glob('../../assets/projects/**/*.webp');
  
  for (const [path, resolver] of Object.entries(imageModules)) {
    if (path.includes(`/${projectId}/`)) {
      const module = await resolver();
      projectImages[path] = module.default;
    }
  }
} catch (error) {
  console.warn(`Could not load images for project ${projectId}:`, error);
}

// Helper function to get image from loaded images
const getProjectImage = (imageName: string) => {
  const possiblePaths = [
    `../../assets/projects/${projectInfo.location.toLowerCase()}/${projectId}/${imageName}.webp`,
    `../../assets/projects/${projectInfo.location.toLowerCase()}/${projectId}/${imageName}`
  ];
  
  for (const path of possiblePaths) {
    if (projectImages[path]) {
      return projectImages[path];
    }
  }
  return null;
};

// Build project data
const heroImg = getProjectImage('main-image') || projectInfo.image;

// Get gallery images dynamically
const galleryImages = [];
for (let i = 1; i <= 15; i++) {
  const img = getProjectImage(`gallery-${i}`);
  if (img) {
    galleryImages.push({
      src: img,
      alt: `${projectInfo.name} - Gallery Image ${i}`,
      width: 1200,
      height: 800
    });
  }
}

// If no gallery images found, use the hero image
if (galleryImages.length === 0 && heroImg) {
  galleryImages.push({
    src: heroImg,
    alt: `${projectInfo.name} - Main Image`,
    width: 1200,
    height: 800
  });
}

const projectData: ProjectData = {
  id: projectId,
  name: projectInfo.name,
  location: projectInfo.location,
  description: 'A luxurious residential development offering modern living spaces with stunning views and world-class amenities.',
  heroImage: {
    src: heroImg,
    alt: `${projectInfo.name} - Main View`,
    width: 1920,
    height: 1080
  },
  info: {
    typology: ['Architecture', 'Residential'],
    status: 'Completed',
    yearOfDesign: 2023,
    location: `${projectInfo.location} Oceanfront`,
    square: '15,000 m2'
  },
  aboutProject: `${projectInfo.name} represents a pinnacle of modern architectural design, seamlessly blending luxury living with sustainable practices. This prestigious development offers residents an unparalleled lifestyle experience with its thoughtfully designed spaces and premium amenities.

The project features state-of-the-art facilities including infinity pools, landscaped gardens, fitness centers, and 24/7 concierge services. Each unit has been meticulously planned to maximize natural light and ventilation while offering breathtaking views of the surrounding landscape.

Key Features:
- Premium location with easy access to major landmarks
- Sustainable design with energy-efficient systems
- High-end finishes and fixtures throughout
- Smart home integration
- Dedicated parking spaces
- Community spaces for social gatherings`,
  galleryImages: galleryImages
};
---

<ProjectLayout project={projectData} />